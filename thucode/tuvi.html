<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üîÆ Xem B√≥i Hi·ªán ƒê·∫°i</title>
<meta name="description" content="Trang xem b√≥i giao di·ªán hi·ªán ƒë·∫°i: Tarot, T·ª≠ vi, Th·∫ßn s·ªë h·ªçc.">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1: #0f1724;
    --bg2: #071028;
    --glass: rgba(255,255,255,0.06);
    --glass-2: rgba(255,255,255,0.04);
    --accent: #8b5cf6;
    --accent-2: #06b6d4;
    --muted: #98a2b3;
    --card-radius: 14px;
    --max-width: 1100px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background: radial-gradient(1200px 800px at 10% 10%, rgba(139,92,246,0.12), transparent 10%), linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#e6eef8; -webkit-font-smoothing:antialiased;
    display:flex;align-items:center;justify-content:center;padding:28px;
  }

  .app {
    width:100%; max-width:var(--max-width);
    display:grid; grid-template-columns: 360px 1fr; gap:24px;
  }
  @media (max-width:980px){ .app{grid-template-columns:1fr;padding:12px} }

  /* Left sidebar */
  .sidebar{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--card-radius); padding:18px; position:relative;
    box-shadow: 0 10px 30px rgba(4,6,12,0.5);
    min-height:420px;
  }
  .brand{display:flex;align-items:center;gap:12px;margin-bottom:10px}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:white;font-size:18px;box-shadow:0 8px 20px rgba(7,18,40,0.6)}
  .appTitle{font-weight:700;font-size:16px}
  .appSub{font-size:13px;color:var(--muted);margin-top:2px}

  .menu{margin-top:18px;display:flex;flex-direction:column;gap:10px}
  .menu button{
    background:transparent;border:1px solid rgba(255,255,255,0.04);padding:12px;border-radius:12px;color:inherit;text-align:left;cursor:pointer;
    display:flex;gap:10px;align-items:center;font-weight:600;
  }
  .menu button.active{background:linear-gradient(90deg, rgba(139,92,246,0.14), rgba(6,182,212,0.04));border:1px solid rgba(255,255,255,0.08);box-shadow:0 6px 18px rgba(6,11,20,0.5)}
  .muted{color:var(--muted);font-size:13px}

  .controls{margin-top:16px;display:flex;flex-direction:column;gap:10px}
  .controls label{font-size:13px;color:var(--muted)}
  .controls input, .controls select{
    width:100%;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;
  }
  .btnPrimary{
    margin-top:10px;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#041125;font-weight:700;cursor:pointer;
    box-shadow:0 8px 18px rgba(6,11,20,0.7);
  }

  .smallNote{font-size:12px;color:var(--muted);margin-top:8px}

  /* Right content */
  .content{
    min-height:420px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--card-radius);padding:20px;position:relative;
    box-shadow: 0 12px 36px rgba(0,0,0,0.5); overflow:hidden;
  }

  .headerRow{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:10px}
  .headerRow h2{margin:0;font-size:18px}
  .headerRow .actions{display:flex;gap:10px}

  .cardArea{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  @media (max-width:980px){ .cardArea{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:520px){ .cardArea{grid-template-columns:1fr} }

  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;padding:14px;min-height:160px;border:1px solid rgba(255,255,255,0.03);
    display:flex;flex-direction:column;gap:12px;justify-content:space-between;
  }
  .card h3{margin:0;font-size:15px}
  .card p{margin:0;color:var(--muted);font-size:13px}

  /* Result area */
  .result{
    margin-top:16px;padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);
    min-height:140px;position:relative;
  }
  .result h3{margin:0 0 8px 0}
  .result .text{color:#eaf3ff;line-height:1.5}

  /* Tarot visuals */
  .tarotRow{display:flex;gap:8px;align-items:center;justify-content:center}
  .cardBack{
    width:78px;height:120px;border-radius:8px;background:linear-gradient(180deg,#0b1220,#08101b);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;
    box-shadow:0 8px 20px rgba(6,10,20,0.6);cursor:pointer;transform-style:preserve-3d;transition:transform 600ms;
  }
  .cardBack.flip{transform:rotateY(180deg)}
  .cardFace{
    position:absolute;width:78px;height:120px;border-radius:8px;backface-visibility:hidden;display:flex;align-items:center;justify-content:center;color:#041125;font-weight:700;
  }

  /* history */
  .history{margin-top:12px;max-height:140px;overflow:auto;padding-right:6px}
  .historyItem{display:flex;justify-content:space-between;gap:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);margin-bottom:6px;font-size:13px}
  .tiny{font-size:12px;color:var(--muted)}

  /* floating accent */
  .accentGlow{position:absolute;right:-120px;top:-80px;width:300px;height:300px;background:radial-gradient(circle at 30% 30%, rgba(139,92,246,0.12), transparent 30%);filter:blur(34px);pointer-events:none}

  /* accessibility focus */
  button:focus, input:focus, select:focus { outline:2px solid rgba(139,92,246,0.3); outline-offset:2px; }

  /* small responsive tweaks */
  @media (max-width:520px){ .sidebar{padding:12px} .controls input, select{padding:10px} }
</style>
</head>
<body>
  <div class="app" role="application" aria-labelledby="appTitle">
    <div class="sidebar" aria-label="B·∫£ng ƒëi·ªÅu khi·ªÉn">
      <div class="brand">
        <div class="logo" aria-hidden="true">üîÆ</div>
        <div>
          <div class="appTitle" id="appTitle">Xem B√≥i Hi·ªán ƒê·∫°i</div>
          <div class="appSub">Tarot ¬∑ T·ª≠ Vi ¬∑ Th·∫ßn S·ªë H·ªçc</div>
        </div>
      </div>

      <nav class="menu" role="navigation" aria-label="Ch·ªçn lo·∫°i b√≥i">
        <button id="tabTarot" class="active" aria-pressed="true">Tarot ‚Äî R√∫t 3 l√°</button>
        <button id="tabZodiac" aria-pressed="false">T·ª≠ Vi ‚Äî Cung Ho√†ng ƒê·∫°o</button>
        <button id="tabNumber" aria-pressed="false">Th·∫ßn S·ªë H·ªçc ‚Äî Numerology</button>
      </nav>

      <div class="controls" aria-hidden="false">
        <label for="nameInput">T√™n (t√πy ch·ªçn)</label>
        <input id="nameInput" type="text" placeholder="V√≠ d·ª•: Linh">

        <label for="dobInput">Ng√†y sinh</label>
        <input id="dobInput" type="date" aria-label="Ng√†y sinh">

        <label for="zodiacSelect">Ho·∫∑c ch·ªçn cung (d√†nh cho T·ª≠ Vi)</label>
        <select id="zodiacSelect" aria-label="Ch·ªçn cung">
          <option value="">(ƒê·ªÉ h·ªá th·ªëng t·ª± t√≠nh t·ª´ ng√†y sinh)</option>
          <option value="B·∫°ch D∆∞∆°ng">B·∫°ch D∆∞∆°ng</option>
          <option value="Kim Ng∆∞u">Kim Ng∆∞u</option>
          <option value="Song T·ª≠">Song T·ª≠</option>
          <option value="C·ª± Gi·∫£i">C·ª± Gi·∫£i</option>
          <option value="S∆∞ T·ª≠">S∆∞ T·ª≠</option>
          <option value="X·ª≠ N·ªØ">X·ª≠ N·ªØ</option>
          <option value="Thi√™n B√¨nh">Thi√™n B√¨nh</option>
          <option value="B·ªç C·∫°p">B·ªç C·∫°p</option>
          <option value="Nh√¢n M√£">Nh√¢n M√£</option>
          <option value="Ma K·∫øt">Ma K·∫øt</option>
          <option value="B·∫£o B√¨nh">B·∫£o B√¨nh</option>
          <option value="Song Ng∆∞">Song Ng∆∞</option>
        </select>

        <button id="goBtn" class="btnPrimary" aria-label="Xem b√≥i">‚ú® Xem ngay</button>
        <div class="smallNote">K·∫øt qu·∫£ mang t√≠nh gi·∫£i tr√≠ ‚Äî h√£y ƒë·ªçc ƒë·ªÉ suy ng·∫´m v√† vui v·∫ª.</div>
      </div>

      <div style="margin-top:12px">
        <div class="muted">L·ªãch s·ª≠</div>
        <div class="history" id="history" aria-live="polite"></div>
      </div>
    </div>

    <main class="content" aria-label="K·∫øt qu·∫£ v√† n·ªôi dung">
      <div class="accentGlow" aria-hidden="true"></div>

      <div class="headerRow">
        <h2>K·∫øt qu·∫£</h2>
        <div class="actions">
          <button id="copyBtn" title="Sao ch√©p k·∫øt qu·∫£">üìã Sao ch√©p</button>
          <button id="shareBtn" title="Chia s·∫ª k·∫øt qu·∫£">üîó Chia s·∫ª</button>
        </div>
      </div>

      <div class="cardArea" id="overview">
        <div class="card">
          <h3>Tarot</h3>
          <p>R√∫t 3 l√° ‚Äî Qu√° kh·ª© ¬∑ Hi·ªán t·∫°i ¬∑ T∆∞∆°ng lai. Nh·∫•p "Xem ngay" ƒë·ªÉ r√∫t.</p>
        </div>
        <div class="card">
          <h3>T·ª≠ Vi</h3>
          <p>ƒê·ªçc nhanh d·ª±a theo cung ho√†ng ƒë·∫°o (t·ª´ ng√†y sinh ho·∫∑c ch·ªçn tay).</p>
        </div>
        <div class="card">
          <h3>Th·∫ßn S·ªë H·ªçc</h3>
          <p>Ch·ªâ s·ªë ch·ªß ƒë·∫°o t·ª´ t√™n v√† ng√†y sinh ‚Äî th·∫•y xu h∆∞·ªõng v·∫≠n m·ªánh & t√≠nh c√°ch.</p>
        </div>
      </div>

      <section class="result" id="resultArea" aria-live="polite">
        <h3 id="resultTitle">Ch∆∞a c√≥ k·∫øt qu·∫£</h3>
        <div class="text" id="resultText">H√£y nh·∫≠p th√¥ng tin v√† nh·∫•n "Xem ngay" ƒë·ªÉ nh·∫≠n k·∫øt qu·∫£.</div>

        <!-- Tarot visuals -->
        <div id="tarotVisual" style="margin-top:12px;display:none;">
          <div class="tarotRow" id="tarotRow" aria-hidden="true">
            <!-- cards injected here -->
          </div>
          <div style="text-align:center;margin-top:8px;"><span class="tiny muted">Nh·∫•p v√†o l√° ƒë·ªÉ l·∫≠t</span></div>
        </div>

      </section>
    </main>
  </div>

<script>
/* ---------- Data (simple templates) ---------- */
const tarotCards = [
  {id:1,name:'The Fool',desc:'B·∫Øt ƒë·∫ßu m·ªõi, phi√™u l∆∞u v√† tin t∆∞·ªüng.'},
  {id:2,name:'The Magician',desc:'NƒÉng l·ª±c, √Ω ch√≠ v√† h√†nh ƒë·ªông.'},
  {id:3,name:'The High Priestess',desc:'Tr·ª±c gi√°c, b√≠ m·∫≠t s√¢u k√≠n.'},
  {id:4,name:'The Empress',desc:'S·ª± phong ph√∫, nu√¥i d∆∞·ª°ng, s√°ng t·∫°o.'},
  {id:5,name:'The Emperor',desc:'Quy·ªÅn l·ª±c, tr·∫≠t t·ª±, l√£nh ƒë·∫°o.'},
  {id:6,name:'The Lovers',desc:'L·ª±a ch·ªçn quan tr·ªçng, t√¨nh c·∫£m.'},
  {id:7,name:'The Chariot',desc:'√ù ch√≠ m·∫°nh m·∫Ω, ti·∫øn t·ªõi th√†nh c√¥ng.'},
  {id:8,name:'Strength',desc:'S·ª©c m·∫°nh n·ªôi t√¢m, s·ª± ki√™n nh·∫´n.'},
  {id:9,name:'Hermit',desc:'T√¨m ki·∫øm ch√¢n l√Ω, th·ªùi gian cho b·∫£n th√¢n.'},
  {id:10,name:'Wheel of Fortune',desc:'Chu k·ª≥, thay ƒë·ªïi, c∆° h·ªôi.'},
  {id:11,name:'Justice',desc:'C√¢n b·∫±ng, quy·∫øt ƒë·ªãnh c√¥ng b·∫±ng.'},
  {id:12,name:'Hanged Man',desc:'G√≥c nh√¨n kh√°c, hy sinh t·∫°m th·ªùi.'},
  {id:13,name:'Death',desc:'K·∫øt th√∫c d·∫´n t·ªõi kh·ªüi ƒë·∫ßu m·ªõi.'},
  {id:14,name:'Temperance',desc:'C√¢n b·∫±ng, ƒëi·ªÅu h√≤a, h√≤a gi·∫£i.'},
  {id:15,name:'Devil',desc:'S·ª± r√†ng bu·ªôc, c√°m d·ªó c·∫ßn nh·∫≠n di·ªán.'},
  {id:16,name:'Tower',desc:'S·ª± s·ª•p ƒë·ªï ƒë·ªôt ng·ªôt, c·∫ßn t√°i thi·∫øt.'},
  {id:17,name:'Star',desc:'Hy v·ªçng, c·∫£m h·ª©ng, ch·ªØa l√†nh.'},
  {id:18,name:'Moon',desc:'S·ª± m∆° h·ªì, ·∫©n khu·∫•t v√† c·∫£m x√∫c.'},
  {id:19,name:'Sun',desc:'Vui v·∫ª, th√†nh t·ª±u, r√µ r√†ng.'},
  {id:20,name:'Judgement',desc:'Th·ª©c t·ªânh, ƒë√°nh gi√° l·∫°i qu√° kh·ª©.'},
  {id:21,name:'World',desc:'Ho√†n thi·ªán, ƒë·∫°t m·ª•c ti√™u.'}
];

const zodiacTemplates = {
  'B·∫°ch D∆∞∆°ng': 'NƒÉng l∆∞·ª£ng m·∫°nh m·∫Ω ‚Äî th·ªùi ƒëi·ªÉm ƒë·ªÉ h√†nh ƒë·ªông. H√£y d√πng quy·∫øt ƒëo√°n nh∆∞ng gi·ªØ m·ªÅm d·∫ªo trong c√°c m·ªëi quan h·ªá.',
  'Kim Ng∆∞u': '·ªîn ƒë·ªãnh, t·∫≠p trung v√†o gi√° tr·ªã c√° nh√¢n. T√†i ch√≠nh v√† an to√†n l√† ch·ªß ƒë·ªÅ ch√≠nh.',
  'Song T·ª≠': 'Giao ti·∫øp l√™n ng√¥i ‚Äî th·ªùi ƒëi·ªÉm ƒë·ªÉ k·∫øt n·ªëi, trao ƒë·ªïi v√† h·ªçc h·ªèi.',
  'C·ª± Gi·∫£i': 'C·∫£m x√∫c s√¢u s·∫Øc ‚Äî chƒÉm s√≥c gia ƒë√¨nh v√† b·∫£n th√¢n l√† ∆∞u ti√™n.',
  'S∆∞ T·ª≠': 'T·ªèa s√°ng ‚Äî t·ª± tin, s√°ng t·∫°o, d·ªÖ thu h√∫t s·ª± ch√∫ √Ω v√† c∆° h·ªôi.',
  'X·ª≠ N·ªØ': 'Chi ti·∫øt & t·ªï ch·ª©c ‚Äî s·∫Øp x·∫øp l·∫°i k·∫ø ho·∫°ch s·∫Ω cho hi·ªáu qu·∫£.',
  'Thi√™n B√¨nh': 'C√¢n b·∫±ng trong quan h·ªá ‚Äî quy·∫øt ƒë·ªãnh kh√¥n ngoan mang l·∫°i h√†i h√≤a.',
  'B·ªç C·∫°p': 'S·ª©c m·∫°nh n·ªôi t√¢m ‚Äî ƒëi s√¢u v√†o b·∫£n ch·∫•t, s·ª± thay ƒë·ªïi c√≥ th·ªÉ di·ªÖn ra.',
  'Nh√¢n M√£': 'M·ªü r·ªông, du l·ªãch ho·∫∑c h·ªçc t·∫≠p ‚Äî c∆° h·ªôi ph√°t tri·ªÉn t·∫ßm nh√¨n.',
  'Ma K·∫øt': 'K·ª∑ lu·∫≠t & n·ªó l·ª±c ‚Äî c√°c b∆∞·ªõc nh·ªè ƒë·ªÅu d·∫´n ƒë·∫øn th√†nh t·ª±u l√¢u d√†i.',
  'B·∫£o B√¨nh': '√ù t∆∞·ªüng m·ªõi, c·ªông ƒë·ªìng h·ªó tr·ª£ ‚Äî ph√° v·ª° th√≥i quen ƒë·ªÉ s√°ng t·∫°o.',
  'Song Ng∆∞': 'Tr·ª±c gi√°c m·∫°nh, ngh·ªá thu·∫≠t & linh c·∫£m ‚Äî l·∫Øng nghe c·∫£m x√∫c.'
};

/* ---------- Utils ---------- */
function randInt(max){ return Math.floor(Math.random()*max); }
function sample(arr){ return arr[randInt(arr.length)]; }
function formatDate(d){ return new Date(d).toLocaleString(); }

/* ---------- State ---------- */
let currentTab = 'tarot';
const historyKey = 'xb_history_v1';

/* ---------- DOM ---------- */
const tabTarot = document.getElementById('tabTarot');
const tabZodiac = document.getElementById('tabZodiac');
const tabNumber = document.getElementById('tabNumber');
const goBtn = document.getElementById('goBtn');
const resultTitle = document.getElementById('resultTitle');
const resultText = document.getElementById('resultText');
const tarotVisual = document.getElementById('tarotVisual');
const tarotRow = document.getElementById('tarotRow');
const historyEl = document.getElementById('history');
const nameInput = document.getElementById('nameInput');
const dobInput = document.getElementById('dobInput');
const zodiacSelect = document.getElementById('zodiacSelect');
const copyBtn = document.getElementById('copyBtn');
const shareBtn = document.getElementById('shareBtn');

/* ---------- Tab handling ---------- */
function setActiveTab(tab){
  currentTab = tab;
  [tabTarot, tabZodiac, tabNumber].forEach(b=> b.classList.remove('active'));
  tabTarot.setAttribute('aria-pressed','false'); tabZodiac.setAttribute('aria-pressed','false'); tabNumber.setAttribute('aria-pressed','false');
  if(tab==='tarot'){ tabTarot.classList.add('active'); tabTarot.setAttribute('aria-pressed','true'); }
  if(tab==='zodiac'){ tabZodiac.classList.add('active'); tabZodiac.setAttribute('aria-pressed','true'); }
  if(tab==='number'){ tabNumber.classList.add('active'); tabNumber.setAttribute('aria-pressed','true'); }
  // hide tarot visuals unless tarot tab
  tarotVisual.style.display = (tab==='tarot') ? 'block' : 'none';
}
tabTarot.addEventListener('click', ()=> setActiveTab('tarot'));
tabZodiac.addEventListener('click', ()=> setActiveTab('zodiac'));
tabNumber.addEventListener('click', ()=> setActiveTab('number'));
setActiveTab('tarot');

/* ---------- Tarot: draw n unique cards ---------- */
function drawTarot(n=3){
  const deck = [...tarotCards];
  const draw = [];
  for(let i=0;i<n;i++){
    const idx = randInt(deck.length);
    const card = deck.splice(idx,1)[0];
    // random orientation
    card.rev = Math.random() < 0.28; // ~28% reversed meaning
    draw.push(card);
  }
  return draw;
}

/* ---------- Zodiac from DOB ---------- */
function zodiacFromDob(dob){
  if(!dob) return '';
  const d = new Date(dob);
  const m = d.getMonth()+1; const day = d.getDate();
  // ranges
  if((m===3 && day>=21) || (m===4 && day<=19)) return 'B·∫°ch D∆∞∆°ng';
  if((m===4 && day>=20) || (m===5 && day<=20)) return 'Kim Ng∆∞u';
  if((m===5 && day>=21) || (m===6 && day<=21)) return 'Song T·ª≠';
  if((m===6 && day>=22) || (m===7 && day<=22)) return 'C·ª± Gi·∫£i';
  if((m===7 && day>=23) || (m===8 && day<=22)) return 'S∆∞ T·ª≠';
  if((m===8 && day>=23) || (m===9 && day<=22)) return 'X·ª≠ N·ªØ';
  if((m===9 && day>=23) || (m===10 && day<=23)) return 'Thi√™n B√¨nh';
  if((m===10 && day>=24) || (m===11 && day<=21)) return 'B·ªç C·∫°p';
  if((m===11 && day>=22) || (m===12 && day<=21)) return 'Nh√¢n M√£';
  if((m===12 && day>=22) || (m===1 && day<=19)) return 'Ma K·∫øt';
  if((m===1 && day>=20) || (m===2 && day<=18)) return 'B·∫£o B√¨nh';
  if((m===2 && day>=19) || (m===3 && day<=20)) return 'Song Ng∆∞';
  return '';
}

/* ---------- Numerology: life path from dob ---------- */
function lifePathNumber(dob){
  if(!dob) return null;
  const d = new Date(dob);
  const s = '' + d.getFullYear() + (''+(d.getMonth()+1)).padStart(2,'0') + (''+d.getDate()).padStart(2,'0');
  // sum digits until 1-9
  let sum = s.split('').reduce((a,c)=>a+Number(c),0);
  while(sum > 9 && sum !== 11 && sum !== 22){
    sum = (''+sum).split('').reduce((a,c)=>a+Number(c),0);
  }
  return sum;
}

/* ---------- Generate result ---------- */
function generateResult(){
  const name = nameInput.value.trim();
  const dob = dobInput.value || null;
  const chosenZodiac = zodiacSelect.value || '';
  let result = {title:'', text:'', meta:''};

  if(currentTab === 'tarot'){
    // draw 3 cards
    const cards = drawTarot(3);
    // visual
    tarotRow.innerHTML = '';
    cards.forEach((c,i)=>{
      const wrapper = document.createElement('div');
      wrapper.style.position='relative';
      wrapper.style.perspective='800px';
      const cardEl = document.createElement('div');
      cardEl.className='cardBack';
      cardEl.setAttribute('tabindex','0');
      cardEl.dataset.idx = i;
      // front face
      const face = document.createElement('div');
      face.className='cardFace';
      face.style.transform='rotateY(180deg)'; face.style.background='linear-gradient(180deg,#fff8ef,#fff1e6)'; face.style.border='1px solid rgba(6,10,20,0.06)'; face.style.color='#2b1b15'; face.style.flexDirection='column'; face.style.justifyContent='center';
      face.innerHTML = `<div style="font-size:13px;font-weight:800">${c.name}${c.rev? ' (ng∆∞·ª£c)':''}</div><div style="font-size:11px;color:#5b4b44;margin-top:8px">${c.desc}</div>`;
      // back face
      cardEl.innerHTML = '<div style="font-size:10px;opacity:0.9">üîÆ</div>';
      // assemble
      wrapper.appendChild(cardEl);
      wrapper.appendChild(face);
      // position
      cardEl.style.transform='rotateY(0deg)';
      face.style.backfaceVisibility='hidden';
      face.style.position='absolute'; face.style.inset='0'; face.style.borderRadius='8px';
      wrapper.style.width='78px';
      wrapper.style.height='120px';
      // click to flip
      let flipped=false;
      function flip(){
        flipped = !flipped;
        if(flipped){
          cardEl.style.transform='rotateY(180deg)';
          face.style.transform='rotateY(0deg)';
        } else {
          cardEl.style.transform='rotateY(0deg)';
          face.style.transform='rotateY(180deg)';
        }
      }
      cardEl.addEventListener('click', flip);
      face.addEventListener('click', flip);
      cardEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') flip(); });
      tarotRow.appendChild(wrapper);
    });
    tarotVisual.style.display = 'block';

    // text
    const past = sample(tarotCards).desc;
    const present = sample(tarotCards).desc;
    const future = sample(tarotCards).desc;
    result.title = 'Tarot ‚Äî 3 l√°';
    result.text = `${name? name + ', ':'B·∫°n,'} nƒÉng l∆∞·ª£ng hi·ªán t·∫°i cho th·∫•y: ${present} Tr∆∞·ªõc ƒë√≥: ${past} V√† s·∫Øp t·ªõi: ${future}`;
    result.meta = `R√∫t l√∫c ${formatDate(new Date())}`;
  }
  else if(currentTab === 'zodiac'){
    // get zodiac
    let zodiac = chosenZodiac || zodiacFromDob(dob);
    if(!zodiac) zodiac = sample(Object.keys(zodiacTemplates));
    result.title = `T·ª≠ vi ‚Äî ${zodiac}`;
    const template = zodiacTemplates[zodiac] || 'NƒÉng l∆∞·ª£ng chung: c·∫ßn ch√∫ √Ω c√¢n b·∫±ng c√° nh√¢n v√† c∆° h·ªôi.';
    result.text = `${name? name + ', ':''}${template} (${dob? 'Sinh ng√†y ' + (new Date(dob)).toLocaleDateString() : 'Ng√†y sinh kh√¥ng cung c·∫•p'})`;
    result.meta = `Ph√¢n t√≠ch nhanh ‚Äî ${formatDate(new Date())}`;
    tarotVisual.style.display = 'none';
  }
  else if(currentTab === 'number'){
    const lp = lifePathNumber(dob);
    result.title = 'Th·∫ßn S·ªë H·ªçc';
    if(lp){
      const descMap = {
        1: 'L√£nh ƒë·∫°o, ƒë·ªôc l·∫≠p, s√°ng t·∫°o.',
        2: 'H·ª£p t√°c, h√†i h√≤a, nh·∫°y c·∫£m.',
        3: 'S√°ng t·∫°o, giao ti·∫øp, vui t∆∞∆°i.',
        4: 'L√†m vi·ªác chƒÉm ch·ªâ, th·ª±c t·∫ø, b·ªÅn b·ªâ.',
        5: 'T·ª± do, phi√™u l∆∞u, thay ƒë·ªïi.',
        6: 'Tr√°ch nhi·ªám, gia ƒë√¨nh, y√™u th∆∞∆°ng.',
        7: 'Suy ng·∫´m, nghi√™n c·ª©u, n·ªôi t√¢m.',
        8: 'Tham v·ªçng, quy·ªÅn l·ª±c, th√†nh c√¥ng.',
        9: 'Vƒ© ƒë·∫°i, nh√¢n ƒë·∫°o, t·∫ßm nh√¨n.',
        11:'Tr·ª±c gi√°c, c·∫£m h·ª©ng (s·ªë ch·ªß).',
        22:'X√¢y d·ª±ng, t·∫ßm ·∫£nh h∆∞·ªüng (s·ªë l·ªõn).'
      };
      result.text = `${name? name + ', ' : ''}Ch·ªâ s·ªë ch·ªß ƒë·∫°o c·ªßa b·∫°n l√† ${lp}: ${descMap[lp] || 'S·ª©c m·∫°nh n·ªôi t√¢m ƒë·∫∑c bi·ªát.'}`;
    } else {
      result.text = 'Vui l√≤ng ch·ªçn ng√†y sinh ƒë·ªÉ t√≠nh Th·∫ßn S·ªë H·ªçc.';
    }
    result.meta = `T√≠nh to√°n l√∫c ${formatDate(new Date())}`;
    tarotVisual.style.display = 'none';
  }

  // render
  resultTitle.textContent = result.title;
  resultText.textContent = result.text + ' ‚Äî ' + result.meta;

  // save history
  saveHistory({tab:currentTab,name:name || '',dob:dob || '',title:result.title,text:result.text,time:new Date().toISOString()});
}

/* ---------- History storage ---------- */
function loadHistory(){
  try{
    const raw = localStorage.getItem(historyKey);
    if(!raw) return [];
    return JSON.parse(raw);
  }catch(e){ return []; }
}
function saveHistoryItem(item){
  const arr = loadHistory();
  arr.unshift(item);
  if(arr.length>30) arr.pop();
  localStorage.setItem(historyKey, JSON.stringify(arr));
  renderHistory();
}
function saveHistory(it){ saveHistoryItem(it); }
function renderHistory(){
  const arr = loadHistory();
  historyEl.innerHTML = arr.map(i=> `<div class="historyItem"><div><strong>${i.title}</strong><div class="tiny">${i.name||'Kh√°ch'} ‚Ä¢ ${ (new Date(i.time)).toLocaleString() }</div></div><div style="text-align:right"><button onclick='replay("${i.time}")'>Xem</button></div></div>`).join('');
}
function replay(time){
  const arr = loadHistory();
  const it = arr.find(a=>a.time===time);
  if(!it) return;
  resultTitle.textContent = it.title;
  resultText.textContent = it.text + ' ‚Äî L∆∞u: ' + (new Date(it.time)).toLocaleString();
}

/* ---------- helper: share & copy ---------- */
copyBtn.addEventListener('click', ()=> {
  const txt = resultTitle.textContent + '\n' + resultText.textContent;
  navigator.clipboard?.writeText(txt).then(()=> alert('ƒê√£ sao ch√©p k·∫øt qu·∫£')).catch(()=> alert('Kh√¥ng th·ªÉ sao ch√©p'));
});
shareBtn.addEventListener('click', async ()=>{
  const txt = resultTitle.textContent + '\n' + resultText.textContent;
  if(navigator.share){
    try{ await navigator.share({title:resultTitle.textContent,text:resultText.textContent}); }
    catch(e){ alert('Chia s·∫ª b·ªã hu·ª∑'); }
  } else {
    alert('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Web Share ‚Äî b·∫°n c√≥ th·ªÉ sao ch√©p k·∫øt qu·∫£.');
  }
});

/* ---------- wire go button ---------- */
goBtn.addEventListener('click', ()=>{
  generateResult();
});

/* ---------- accessibility: keyboard shortcuts ---------- */
window.addEventListener('keydown',(e)=> {
  if(e.key==='1') setActiveTab('tarot');
  if(e.key==='2') setActiveTab('zodiac');
  if(e.key==='3') setActiveTab('number');
  if(e.key==='Enter' && (e.ctrlKey||e.metaKey)) generateResult();
});

/* ---------- init ---------- */
renderHistory();

</script>
</body>
</html>
